<h2><%= file.fileName %></h2>

<div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;">
    <h4>File Details</h4>
    <table style="width: 100%;">
        <tr>
            <td style="padding: 8px; width: 150px; font-weight: bold;">File Name:</td>
            <td style="padding: 8px;"><%= file.fileName %></td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">File Size:</td>
            <td style="padding: 8px;"><%= Math.round(file.fileSize / 1024) %> KB</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">Owner:</td>
            <td style="padding: 8px;"><%= file.owner.name %> (<%= file.owner.email %>)</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">Created:</td>
            <td style="padding: 8px;"><%= new Date(file.uploadDate).toLocaleString() %></td>
        </tr>
        <% if (file.lastEditDate) { %>
            <tr>
                <td style="padding: 8px; font-weight: bold;">Last Modified:</td>
                <td style="padding: 8px;">
                    <%= new Date(file.lastEditDate).toLocaleString() %> 
                    <% if (file.lastModifiedBy) { %>
                        by <%= file.lastModifiedBy.name %>
                    <% } %>
                </td>
            </tr>
        <% } %>
        <tr>
            <td style="padding: 8px; font-weight: bold;">Status:</td>
            <td style="padding: 8px;">
                <% if (file.status === "pending_confirmation") { %>
                    <span style="background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 3px;">‚è≥ Pending Confirmation</span>
                <% } else if (file.status === "pending_approval") { %>
                    <span style="background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 3px;">‚è∏Ô∏è Pending Approval</span>
                <% } else if (file.status === "pending_delete") { %>
                    <span style="background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 3px;">üóëÔ∏è Deletion Pending</span>
                <% } else { %>
                    <span style="background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 3px;">‚úì Synced</span>
                <% } %>
            </td>
        </tr>
        <% if (file.changeType) { %>
            <tr>
                <td style="padding: 8px; font-weight: bold;">Change Type:</td>
                <td style="padding: 8px;">
                    <% if (file.changeType === "create") { %>
                        <span style="background: #cfe2ff; color: #084298; padding: 4px 8px; border-radius: 3px;">+ Created</span>
                    <% } else if (file.changeType === "edit") { %>
                        <span style="background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 3px;">‚úèÔ∏è Edited</span>
                    <% } else if (file.changeType === "delete") { %>
                        <span style="background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 3px;">üóëÔ∏è Marked for Deletion</span>
                    <% } %>
                </td>
            </tr>
        <% } %>
    </table>
</div>

<% function isDisplayable(mime) {
    if (!mime) return true; // fallback to showing content if we have fileContent
    return mime.startsWith('text/') || mime === 'application/json' || mime === 'application/xml' || mime === 'text/csv' || mime === 'application/javascript';
} %>

<% const hasInlineContent = file.fileContent && String(file.fileContent).trim().length > 0; %>
<% if (file.oldFileContent && file.changeType === "edit") { %>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <!-- Old Content -->
        <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #f9f9f9;">
            <h4>Previous Content (Read-Only)</h4>
            <p style="color: #666; font-size: 12px;">Last version before edit</p>
            <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; max-height: 400px; overflow-y: auto; color: #555;"><%= file.oldFileContent || '(empty)' %></pre>
        </div>

        <!-- Current Content -->
        <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fffbf0;">
            <h4>Current Content (Read-Only)</h4>
            <p style="color: #666; font-size: 12px;">Latest version</p>
            <% if (hasInlineContent) { %>
                <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; max-height: 400px; overflow-y: auto; color: #555;"><%= file.fileContent %></pre>
            <% } else if (file.mimeType && !isDisplayable(file.mimeType)) { %>
                <p><strong>Uploaded file:</strong> <%= file.originalName || file.fileName %></p>
                <a href="/files/<%= file._id %>/download" class="btn-small btn-view">‚¨áÔ∏è Download File</a>
            <% } else { %>
                <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; max-height: 400px; overflow-y: auto; color: #555;"><%= file.fileContent || '(empty)' %></pre>
            <% } %>
        </div>
    </div>
<% } else { %>
    <!-- Single Content Display -->
    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fffbf0; margin-bottom: 20px;">
        <h4>File Content (Read-Only)</h4>
        <% if (hasInlineContent) { %>
            <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; max-height: 500px; overflow-y: auto; color: #555;"><%= file.fileContent %></pre>
        <% } else if (file.mimeType && !isDisplayable(file.mimeType)) { %>
            <p><strong>Uploaded file:</strong> <%= file.originalName || file.fileName %></p>
            <a href="/files/<%= file._id %>/download" class="btn-small btn-view">‚¨áÔ∏è Download File</a>
        <% } else { %>
            <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; max-height: 500px; overflow-y: auto; color: #555;"><%= file.fileContent || '(empty)' %></pre>
        <% } %>
    </div>
<% } %>

<div style="margin-top: 20px;">
    <a href="/files" class="btn" style="background: #6c757d; color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none; display: inline-block;">‚Üê Back to Files</a>
</div>

<style>
    h4 {
        margin-top: 0;
        color: #333;
    }

    pre {
        font-size: 13px;
        line-height: 1.5;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: 'Courier New', monospace;
    }

    table {
        border-collapse: collapse;
    }

    table tr {
        border-bottom: 1px solid #e0e0e0;
    }

    table tr:last-child {
        border-bottom: none;
    }

    .btn {
        transition: background 0.2s;
    }

    .btn:hover {
        background: #5a6268 !important;
    }
</style>
